var __awaiter=this&&this.__awaiter||function(e,t,i,o){function s(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,n){function r(e){try{a(o.next(e))}catch(t){n(t)}}function c(e){try{a(o["throw"](e))}catch(t){n(t)}}function a(e){e.done?i(e.value):s(e.value).then(r,c)}a((o=o.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var i={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},o,s,n,r;return r={next:c(0),throw:c(1),return:c(2)},typeof Symbol==="function"&&(r[Symbol.iterator]=function(){return this}),r;function c(e){return function(t){return a([e,t])}}function a(r){if(o)throw new TypeError("Generator is already executing.");while(i)try{if(o=1,s&&(n=r[0]&2?s["return"]:r[0]?s["throw"]||((n=s["return"])&&n.call(s),0):s.next)&&!(n=n.call(s,r[1])).done)return n;if(s=0,n)r=[r[0]&2,n.value];switch(r[0]){case 0:case 1:n=r;break;case 4:i.label++;return{value:r[1],done:false};case 5:i.label++;s=r[1];r=[0];continue;case 7:r=i.ops.pop();i.trys.pop();continue;default:if(!(n=i.trys,n=n.length>0&&n[n.length-1])&&(r[0]===6||r[0]===2)){i=0;continue}if(r[0]===3&&(!n||r[1]>n[0]&&r[1]<n[3])){i.label=r[1];break}if(r[0]===6&&i.label<n[1]){i.label=n[1];n=r;break}if(n&&i.label<n[2]){i.label=n[2];i.ops.push(r);break}if(n[2])i.ops.pop();i.trys.pop();continue}r=t.call(e,i)}catch(c){r=[6,c];s=0}finally{o=n=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:true}}};
/*!
 * Built with Duet Design System
 */import{h,F as Fragment,r as registerInstance,c as createEvent,H as Host,g as getElement}from"./index-81967d12.js";import{i as inheritGlobalTheme}from"./themeable-component-cb76be7c.js";import{d as debounce}from"./js-utils-fa98b8cd.js";import{n as isEnterKey,f as isEscapeKey,o as isTabKey,b as isArrowUpKey,c as isArrowDownKey}from"./keyboard-utils-88ea1007.js";import{g as getLocaleString,a as getLanguage}from"./language-utils-bf701d37.js";import{p as parsePossibleJSON}from"./string-utils-5954f458.js";var SelectSingle=function(e){var t=e.item,i=e.search,o=i===void 0?"":i,s=e.selected;var n=o!==""?new RegExp("("+o.split(" ").join("|")+")","gi"):undefined;return h(Fragment,null,s&&h("duet-icon",{class:"option-icon",name:"messaging-checked",size:"xx-small",margin:"none"}),n?h("span",{class:"option-container","aria-hidden":"true"},h("span",{innerHTML:t.name.replace(n,'<span class="highlight">$&</span>')})):t.name,t.tags&&h("span",{class:"option-tags"},t.tags.join(", ")))};var DuetComboBoxSelect=function(e){var t=e.item,i=e.active,o=e.total,s=e.selected,n=e.label,r=n===void 0?undefined:n,c=e.clickHandler,a=c===void 0?function(e){e.preventDefault()}:c,l=e.keyHandler,u=l===void 0?function(e){e.preventDefault()}:l,d=e.search;return h("li",{class:{"list-item":true,option:true,active:i,selected:s},id:i?"active_item":"","data-index":t.id,"aria-selected":i?"true":undefined,"aria-current":s?"true":undefined,role:"option","aria-label":r||"".concat(t.name,", (").concat(t.id+1," of ").concat(o,")")},h("a",{tabindex:"-1",onClick:function(e){return a(e)},onKeyUp:function(e){return u(e)},class:"option-link","aria-label":r||"".concat(t.name,", (").concat(t.id+1," of ").concat(o,")"),"aria-hidden":"true"},h(SelectSingle,{item:t,search:d,selected:s})))};var duetComboboxCss='.sc-duet-combobox-h{box-sizing:border-box;padding:0;margin:0;background:transparent;border:0;-moz-appearance:none;-webkit-appearance:none;appearance:none;position:relative;width:auto;font-family:"localtapiola-sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";color:#00294d}.duet-combobox-list.sc-duet-combobox{position:absolute;top:calc(100% - 12px);display:none;overflow:hidden;background:white;border-radius:0 4px;box-shadow:0 2px 10px 0 rgba(0, 41, 77, 0.1)}.duet-combobox-list.open.sc-duet-combobox{z-index:700;display:block}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox{max-height:200px;padding:0.75rem 0;margin:0;overflow-y:scroll;font-weight:600;list-style:none;cursor:pointer;scroll-behavior:smooth}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox{padding:4px 0}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:not(.selected){padding-left:16px}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:not(.selected) .highlight.sc-duet-combobox{text-decoration:underline}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.option.sc-duet-combobox .option-link.sc-duet-combobox{display:block;width:100%}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.option.sc-duet-combobox .option-tags.sc-duet-combobox{float:right;padding-right:0.875rem;font-weight:400;color:#909599}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.option-link.sc-duet-combobox{display:block;width:100%}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.selected.sc-duet-combobox{padding-left:0;background:#cde5f1}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.selected.option.sc-duet-combobox .option-icon.sc-duet-combobox{padding:0 8px 0 8px}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.selected.option.sc-duet-combobox .option-tags.sc-duet-combobox{color:#909599}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.active.sc-duet-combobox,.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:focus,.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:hover{color:white;background:#0077b3}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.active.sc-duet-combobox .option-tags.sc-duet-combobox,.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:focus .option-tags.sc-duet-combobox,.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:hover .option-tags.sc-duet-combobox{color:#e1e3e6}';var DuetCombobox=function(){function e(e){var t=this;registerInstance(this,e);this.duetChange=createEvent(this,"duetChange",3);this.isSafari=false;this.resizeObserver=new ResizeObserver(debounce((function(e){var i,o;if((e===null||e===void 0?void 0:e.length)===1){var s=(o=(i=e[0])===null||i===void 0?void 0:i.target)===null||o===void 0?void 0:o.getBoundingClientRect().width;t.listContainer.style.width="".concat(s+1,"px")}}),100));this.processedItems=null;this.inputWidth=0;this.inputValue="";this.selectionMsg="";this.listOpen=false;this.selectedItems=new Set;this.activeItem=undefined;this.accessibleLabelDefaults={en:{heading:"Select:",item:"{name}, ({current} of {total})",itemFiltered:"{name}, ({current} of {total}, {hiddenItems} filtered)"},fi:{heading:"Valitse:",item:"{name}, ({current}/{total})",itemFiltered:"{name}, ({current}/{total}, {hiddenItems} suodatettu)"},sv:{heading:"VÃ¤lj:",item:"{name}, ({current} av {total})",itemFiltered:"{name}, ({current} av {total}, {hiddenItems} filtrerade)"}};this.accessibleLabels=getLocaleString(parsePossibleJSON(this.accessibleLabelDefaults),getLanguage());this.theme="";this.force=false;this.formatter=function(e){return e&&e.name?e.name:""}}e.prototype.activeItemHandler=function(e){this.input.accessibleActiveDescendant=this.listOpen&&(e||e===0)?"active_item":""};e.prototype.handleDocumentClick=function(e){var t=this;var i=e.composedPath();var o=i.every((function(e){return e!==t.element}));if(o){this.updateInputText(true);this.listOpen=false}};e.prototype.formatItem=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.formatter(e)]}))}))};e.prototype.componentWillLoad=function(){inheritGlobalTheme(this)};e.prototype.connectedCallback=function(){var e=this;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){this.isSafari=true}this.items=this.processedItems=parsePossibleJSON(this.items);this.input=this.element.querySelector("duet-input");this.input.addEventListener("duetChange",this.updateInputValue.bind(this));this.input.addEventListener("click",(function(){e.inputValue.length?e.listOpen=true:e.listOpen=false}));this.element.addEventListener("keydown",this.handleInputKeyDownEvent.bind(this));this.input.accessibleAutocomplete="list";this.input.accessibleControls="duet-combobox-list-element"};e.prototype.disconnectedCallback=function(){var e=this;this.input.removeEventListener("duetChange",this.updateInputValue.bind(this));this.input.removeEventListener("click",(function(){return e.inputValue.length?e.listOpen=true:e.listOpen=false}));this.element.removeEventListener("keydown",this.handleInputKeyDownEvent.bind(this));this.listElement.removeEventListener("click",(function(e){e.stopPropagation()}));this.resizeObserver.disconnect()};e.prototype.componentDidLoad=function(){this.resizeObserver.observe(this.input);this.listElement.addEventListener("click",(function(e){e.stopPropagation()}))};e.prototype.onListClick=function(e,t){e.preventDefault();this.updateSelectedItems(t.id);this.listOpen=false;return this.listOpen};e.prototype.shouldListBeFiltered=function(){var e=this;if(this.selectedItems.size&&this.input.value===this.inputValue){var t=this.items.filter((function(t){return e.selectedItems.has(t.id)}));return!(this.formatter(t).toLowerCase()===this.input.value.toLowerCase())}return true};e.prototype.returnFilteredOrNonFiltered=function(){return this.processedItems?this.shouldListBeFiltered()?this.getFilteredItems():this.sortFilteredItems(this.processedItems):[]};e.prototype.updateSelectedItems=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:this.selectedItems.clear();if(this.selectedItems){if(this.selectedItems.has(e)){this.selectedItems.delete(e)}else{this.selectedItems.add(e)}}return[4,this.updateInputText()];case 1:t.sent();return[2]}}))}))};e.prototype.updateInputText=function(e){if(e===void 0){e=false}return __awaiter(this,void 0,void 0,(function(){var t,i,o;var s=this;return __generator(this,(function(n){switch(n.label){case 0:t=this.selectedItems.size===0?[]:this.items.filter((function(e){return s.selectedItems.has(e.id)}));if(!(this.selectedItems.size===1))return[3,3];this.input.value="";i=this.input;return[4,this.formatItem(t[0])];case 1:i.value=n.sent();this.input.scrollLeft=this.input.scrollWidth;this.activeItem=undefined;o=this;return[4,this.formatItem(t[0])];case 2:o.value=n.sent();this.duetChange.emit({value:t[0].value,item:t[0],component:"duet-combobox"});return[3,4];case 3:if(e&&this.selectedItems.size===0){if(this.force){this.inputValue="";this.input.value=""}this.activeItem=undefined}n.label=4;case 4:this.listOpen=false;return[2]}}))}))};e.prototype.updateInputValue=function(e){var t;this.inputValue=e.detail.value;this.listOpen=String(this.inputValue).length>0&&((t=this.getFilteredItems())===null||t===void 0?void 0:t.length)>0};e.prototype.handleInputKeyDownEvent=function(e){this.input.accessibleActiveDescendant=undefined;if(isEnterKey(e)){e.preventDefault();this.selectActiveItem();this.listOpen=false;return}if(isEscapeKey(e)||isTabKey(e)){this.updateInputText(true);this.listOpen=false;return}var t=this.activeItem;if(isArrowUpKey(e)){e.preventDefault();t=this.activeItem-1}else if(isArrowDownKey(e)){e.preventDefault();t=this.listOpen?this.activeItem+1:this.activeItem;this.listOpen=true}if(isArrowDownKey(e)||isArrowUpKey(e)){var i=this.shouldListBeFiltered()?this.getFilteredItems():this.processedItems;if(t<0||!t){t=0}if(t>=i.length){t=i.length-1}this.input.accessibleActiveDescendant="active_item";this.activeItem=t;this.scrollToActive()}this.announceActive();return};e.prototype.selectActiveItem=function(){if(this.activeItem===undefined){return}var e=this.returnFilteredOrNonFiltered();var t=e[this.activeItem];this.updateSelectedItems(t.id)};e.prototype.announceActive=function(e){if(!e){e=this.returnFilteredOrNonFiltered()}if(this.activeItem===undefined||this.activeItem===-1){return}var t=e[this.activeItem];this.selectionMsg=this.formatLabel(t,e.length,this.items.length)};e.prototype.scrollToActive=function(){var e=this.listElement.querySelector(".active");if(e){e.scrollIntoView({behavior:"smooth",block:"center"})}};e.prototype.formatLabel=function(e,t,i){if(!e||i===undefined){return""}var o=t===i?this.accessibleLabels.item:this.accessibleLabels.itemFiltered;return o.replace("{name}",String(e.name)).replace("{current}",String(this.activeItem+1)).replace("{total}",String(t)).replace("{hiddenItems}",String(i-t))};e.prototype.getFilteredItems=function(){var e=this;var t=this.processedItems.filter((function(t){return String(t.value).toLowerCase().includes(e.inputValue.toLowerCase())||String(t.name).toLowerCase().includes(e.inputValue.toLowerCase())||e.selectedItems.has(t.id)}));return this.sortFilteredItems(t)};e.prototype.sortFilteredItems=function(e){var t=this;if(e.length>0){e.filter((function(e){return t.selectedItems.has(e.id)})).forEach((function(t){var i=e.indexOf(t);e.splice(i,1);e.unshift(t)}))}return e};e.prototype.render=function(){var e;var t=this;var i=this.returnFilteredOrNonFiltered();return h(Host,{role:"combobox","aria-expanded":this.listOpen?"true":"false","aria-owns":this.listOpen?"duet-combobox-list-element":undefined,"aria-haspopup":"listbox",class:(e={"duet-combobox":true},e["duet-theme-".concat(this.theme)]=true,e)},h("slot",null),this.isSafari&&h("duet-visually-hidden",{"aria-live":"assertive","aria-atomic":"true","aria-relevant":"all"},this.selectionMsg),h("div",{role:"list",class:{"duet-combobox-list":true,open:this.listOpen},ref:function(e){return t.listContainer=e}},h("ul",{role:"listbox",ref:function(e){return t.listElement=e},id:"duet-combobox-list-element",class:"listbox"},this.processedItems&&i.map((function(e,o){return h(DuetComboBoxSelect,{item:e,active:o===t.activeItem,selected:t.selectedItems.has(e.id),search:t.inputValue,total:i.length,clickHandler:function(i){return t.onListClick(i,e)},label:t.formatLabel(e,t.returnFilteredOrNonFiltered().length,t.items.length)})})))))};Object.defineProperty(e.prototype,"element",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(e,"watchers",{get:function(){return{activeItem:["activeItemHandler"]}},enumerable:false,configurable:true});return e}();DuetCombobox.style=duetComboboxCss;export{DuetCombobox as duet_combobox};