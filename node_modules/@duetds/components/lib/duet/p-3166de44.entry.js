/*!
 * Built with Duet Design System
 */
import{h as t,F as o,r as i,c as e,H as s,g as c}from"./p-dc6fd9c6.js";import{i as d}from"./p-4ebf1618.js";import{d as b}from"./p-0b3f675e.js";import{n as l,f as a,o as n,b as h,c as r}from"./p-54f35a79.js";import{g as m,a as u}from"./p-ede854e1.js";import{p as x}from"./p-5a9d75e1.js";const p=({item:i,search:e="",selected:s})=>{const c=""!==e?new RegExp("("+e.split(" ").join("|")+")","gi"):void 0;return t(o,null,s&&t("duet-icon",{class:"option-icon",name:"messaging-checked",size:"xx-small",margin:"none"}),c?t("span",{class:"option-container","aria-hidden":"true"},t("span",{innerHTML:i.name.replace(c,'<span class="highlight">$&</span>')})):i.name,i.tags&&t("span",{class:"option-tags"},i.tags.join(", ")))},g=({item:o,active:i,total:e,selected:s,label:c,clickHandler:d=(t=>{t.preventDefault()}),keyHandler:b=(t=>{t.preventDefault()}),search:l})=>t("li",{class:{"list-item":!0,option:!0,active:i,selected:s},id:i?"active_item":"","data-index":o.id,"aria-selected":i?"true":void 0,"aria-current":s?"true":void 0,role:"option","aria-label":c||`${o.name}, (${o.id+1} of ${e})`},t("a",{tabindex:"-1",onClick:t=>d(t),onKeyUp:t=>b(t),class:"option-link","aria-label":c||`${o.name}, (${o.id+1} of ${e})`,"aria-hidden":"true"},t(p,{item:o,search:l,selected:s}))),v=class{constructor(t){i(this,t),this.duetChange=e(this,"duetChange",3),this.isSafari=!1,this.resizeObserver=new ResizeObserver(b((t=>{var o,i;if(1===(null==t?void 0:t.length)){const e=null===(i=null===(o=t[0])||void 0===o?void 0:o.target)||void 0===i?void 0:i.getBoundingClientRect().width;this.listContainer.style.width=`${e+1}px`}}),100)),this.processedItems=null,this.inputWidth=0,this.inputValue="",this.selectionMsg="",this.listOpen=!1,this.selectedItems=new Set,this.activeItem=void 0,this.accessibleLabelDefaults={en:{heading:"Select:",item:"{name}, ({current} of {total})",itemFiltered:"{name}, ({current} of {total}, {hiddenItems} filtered)"},fi:{heading:"Valitse:",item:"{name}, ({current}/{total})",itemFiltered:"{name}, ({current}/{total}, {hiddenItems} suodatettu)"},sv:{heading:"VÃ¤lj:",item:"{name}, ({current} av {total})",itemFiltered:"{name}, ({current} av {total}, {hiddenItems} filtrerade)"}},this.accessibleLabels=m(x(this.accessibleLabelDefaults),u()),this.theme="",this.force=!1,this.formatter=t=>t&&t.name?t.name:""}activeItemHandler(t){this.input.accessibleActiveDescendant=this.listOpen&&(t||0===t)?"active_item":""}handleDocumentClick(t){t.composedPath().every((t=>t!==this.element))&&(this.updateInputText(!0),this.listOpen=!1)}async formatItem(t){return this.formatter(t)}componentWillLoad(){d(this)}connectedCallback(){/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&(this.isSafari=!0),this.items=this.processedItems=x(this.items),this.input=this.element.querySelector("duet-input"),this.input.addEventListener("duetChange",this.updateInputValue.bind(this)),this.input.addEventListener("click",(()=>{this.listOpen=!!this.inputValue.length})),this.element.addEventListener("keydown",this.handleInputKeyDownEvent.bind(this)),this.input.accessibleAutocomplete="list",this.input.accessibleControls="duet-combobox-list-element"}disconnectedCallback(){this.input.removeEventListener("duetChange",this.updateInputValue.bind(this)),this.input.removeEventListener("click",(()=>this.listOpen=!!this.inputValue.length)),this.element.removeEventListener("keydown",this.handleInputKeyDownEvent.bind(this)),this.listElement.removeEventListener("click",(t=>{t.stopPropagation()})),this.resizeObserver.disconnect()}componentDidLoad(){this.resizeObserver.observe(this.input),this.listElement.addEventListener("click",(t=>{t.stopPropagation()}))}onListClick(t,o){return t.preventDefault(),this.updateSelectedItems(o.id),this.listOpen=!1,this.listOpen}shouldListBeFiltered(){if(this.selectedItems.size&&this.input.value===this.inputValue){const t=this.items.filter((t=>this.selectedItems.has(t.id)));return!(this.formatter(t).toLowerCase()===this.input.value.toLowerCase())}return!0}returnFilteredOrNonFiltered(){return this.processedItems?this.shouldListBeFiltered()?this.getFilteredItems():this.sortFilteredItems(this.processedItems):[]}async updateSelectedItems(t){this.selectedItems.clear(),this.selectedItems&&(this.selectedItems.has(t)?this.selectedItems.delete(t):this.selectedItems.add(t)),await this.updateInputText()}async updateInputText(t=!1){const o=0===this.selectedItems.size?[]:this.items.filter((t=>this.selectedItems.has(t.id)));1===this.selectedItems.size?(this.input.value="",this.input.value=await this.formatItem(o[0]),this.input.scrollLeft=this.input.scrollWidth,this.activeItem=void 0,this.value=await this.formatItem(o[0]),this.duetChange.emit({value:o[0].value,item:o[0],component:"duet-combobox"})):t&&0===this.selectedItems.size&&(this.force&&(this.inputValue="",this.input.value=""),this.activeItem=void 0),this.listOpen=!1}updateInputValue(t){var o;this.inputValue=t.detail.value,this.listOpen=String(this.inputValue).length>0&&(null===(o=this.getFilteredItems())||void 0===o?void 0:o.length)>0}handleInputKeyDownEvent(t){if(this.input.accessibleActiveDescendant=void 0,l(t))return t.preventDefault(),this.selectActiveItem(),void(this.listOpen=!1);if(a(t)||n(t))return this.updateInputText(!0),void(this.listOpen=!1);let o=this.activeItem;if(h(t)?(t.preventDefault(),o=this.activeItem-1):r(t)&&(t.preventDefault(),o=this.listOpen?this.activeItem+1:this.activeItem,this.listOpen=!0),r(t)||h(t)){const t=this.shouldListBeFiltered()?this.getFilteredItems():this.processedItems;(o<0||!o)&&(o=0),o>=t.length&&(o=t.length-1),this.input.accessibleActiveDescendant="active_item",this.activeItem=o,this.scrollToActive()}this.announceActive()}selectActiveItem(){if(void 0===this.activeItem)return;const t=this.returnFilteredOrNonFiltered();this.updateSelectedItems(t[this.activeItem].id)}announceActive(t){t||(t=this.returnFilteredOrNonFiltered()),void 0!==this.activeItem&&-1!==this.activeItem&&(this.selectionMsg=this.formatLabel(t[this.activeItem],t.length,this.items.length))}scrollToActive(){const t=this.listElement.querySelector(".active");t&&t.scrollIntoView({behavior:"smooth",block:"center"})}formatLabel(t,o,i){return t&&void 0!==i?(o===i?this.accessibleLabels.item:this.accessibleLabels.itemFiltered).replace("{name}",String(t.name)).replace("{current}",String(this.activeItem+1)).replace("{total}",String(o)).replace("{hiddenItems}",String(i-o)):""}getFilteredItems(){const t=this.processedItems.filter((t=>String(t.value).toLowerCase().includes(this.inputValue.toLowerCase())||String(t.name).toLowerCase().includes(this.inputValue.toLowerCase())||this.selectedItems.has(t.id)));return this.sortFilteredItems(t)}sortFilteredItems(t){return t.length>0&&t.filter((t=>this.selectedItems.has(t.id))).forEach((o=>{const i=t.indexOf(o);t.splice(i,1),t.unshift(o)})),t}render(){const o=this.returnFilteredOrNonFiltered();return t(s,{role:"combobox","aria-expanded":this.listOpen?"true":"false","aria-owns":this.listOpen?"duet-combobox-list-element":void 0,"aria-haspopup":"listbox",class:{"duet-combobox":!0,[`duet-theme-${this.theme}`]:!0}},t("slot",null),this.isSafari&&t("duet-visually-hidden",{"aria-live":"assertive","aria-atomic":"true","aria-relevant":"all"},this.selectionMsg),t("div",{role:"list",class:{"duet-combobox-list":!0,open:this.listOpen},ref:t=>this.listContainer=t},t("ul",{role:"listbox",ref:t=>this.listElement=t,id:"duet-combobox-list-element",class:"listbox"},this.processedItems&&o.map(((i,e)=>t(g,{item:i,active:e===this.activeItem,selected:this.selectedItems.has(i.id),search:this.inputValue,total:o.length,clickHandler:t=>this.onListClick(t,i),label:this.formatLabel(i,this.returnFilteredOrNonFiltered().length,this.items.length)}))))))}get element(){return c(this)}static get watchers(){return{activeItem:["activeItemHandler"]}}};v.style='.sc-duet-combobox-h{box-sizing:border-box;padding:0;margin:0;background:transparent;border:0;-moz-appearance:none;-webkit-appearance:none;appearance:none;position:relative;width:auto;font-family:"localtapiola-sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";color:#00294d}.duet-combobox-list.sc-duet-combobox{position:absolute;top:calc(100% - 12px);display:none;overflow:hidden;background:white;border-radius:0 4px;box-shadow:0 2px 10px 0 rgba(0, 41, 77, 0.1)}.duet-combobox-list.open.sc-duet-combobox{z-index:700;display:block}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox{max-height:200px;padding:0.75rem 0;margin:0;overflow-y:scroll;font-weight:600;list-style:none;cursor:pointer;scroll-behavior:smooth}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox{padding:4px 0}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:not(.selected){padding-left:16px}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:not(.selected) .highlight.sc-duet-combobox{text-decoration:underline}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.option.sc-duet-combobox .option-link.sc-duet-combobox{display:block;width:100%}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.option.sc-duet-combobox .option-tags.sc-duet-combobox{float:right;padding-right:0.875rem;font-weight:400;color:#909599}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.option-link.sc-duet-combobox{display:block;width:100%}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.selected.sc-duet-combobox{padding-left:0;background:#cde5f1}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.selected.option.sc-duet-combobox .option-icon.sc-duet-combobox{padding:0 8px 0 8px}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.selected.option.sc-duet-combobox .option-tags.sc-duet-combobox{color:#909599}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.active.sc-duet-combobox,.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:focus,.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:hover{color:white;background:#0077b3}.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.active.sc-duet-combobox .option-tags.sc-duet-combobox,.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:focus .option-tags.sc-duet-combobox,.duet-combobox-list.sc-duet-combobox .listbox.sc-duet-combobox .list-item.sc-duet-combobox:hover .option-tags.sc-duet-combobox{color:#e1e3e6}';export{v as duet_combobox}