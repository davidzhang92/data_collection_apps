const path = require("path")
const metadata = require("../_data/duet-icons.json")

// key icons by name for easy lookup
const icons = {}
metadata.icons.forEach(icon => {
  icons[icon.title] = icon
})

const checkMetaData = (ast, params, info) => {
  const parsedPath = path.parse(info.path)
  const filename = parsedPath.name

  // this makes sure that the code below only runs for the svg-ast instead of all elements
  if (ast.name === "svg") {
    const icon = icons[filename]

    if (!icon) {
      throw new Error(`Missing metadata for icon: ${info.path}`)
    }
    if (!icon.tags) {
      throw new Error(`Missing tags for icon: ${info.path}`)
    }
  }

  return ast
}

module.exports = checkMetaData
