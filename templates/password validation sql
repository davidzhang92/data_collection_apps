CREATE PROCEDURE AuthenticateUserPassword
    @StoredSalt VARCHAR(25),
    @StoredHashedPassword VARBINARY(MAX),
    @ProvidedPassword NVARCHAR(50)
AS
BEGIN
    DECLARE @ComputedHash VARBINARY(MAX);

    -- Compute the hash of the provided password with the stored salt
    SET @ComputedHash = HASHBYTES('SHA2_512', CAST(@ProvidedPassword AS VARBINARY(MAX)) + CAST(@StoredSalt AS VARBINARY(MAX)));

    IF @ComputedHash = @StoredHashedPassword
    BEGIN
        PRINT '1';
    END
    ELSE
    BEGIN
        PRINT '0';
    END
END;

-- sp execution

DECLARE @Username NVARCHAR(50) = 'test1';
DECLARE @Password NVARCHAR(50) = 'Password1';
DECLARE @StoredHashedPassword VARBINARY(MAX);
DECLARE @StoredSalt VARCHAR(50);


SELECT @StoredHashedPassword = password_hash FROM user_master WHERE username = @Username;
SELECT @StoredSalt = salt FROM user_master WHERE username = @Username;

EXEC AuthenticateUserPassword @StoredSalt, @StoredHashedPassword, @Password;
